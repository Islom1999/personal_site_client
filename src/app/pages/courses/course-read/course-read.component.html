<!-- Course Read Page -->
<div class="min-h-screen bg-gray-50">
  <!-- Course Header -->
  <div class="bg-white shadow-sm border-b sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex items-center justify-between">
        <!-- Course Info -->
        <div class="flex items-center space-x-4">
          <p-button 
            icon="pi pi-arrow-left" 
            [text]="true" 
            [rounded]="true"
            class="text-gray-600 hover:bg-gray-100"
            routerLink="/courses"
            pTooltip="Kurslarga qaytish"
          >
          </p-button>
          <div>
            <h1 class="text-xl font-bold text-gray-900">{{ courseData?.name }}</h1>
            <p class="text-sm text-gray-600">{{ courseData?.instructor }}</p>
          </div>
        </div>

        <!-- Course Progress -->
        <div class="flex items-center space-x-4">
          <div class="text-right">
            <div class="text-sm text-gray-600">Jarayon</div>
            <div class="font-semibold text-blue-600">{{ courseProgress }}%</div>
          </div>
          <div class="w-32">
            <p-progressBar [value]="courseProgress" [showValue]="false" class="h-2"></p-progressBar>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Course Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      <!-- Course Modules Sidebar -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
          <h3 class="text-lg font-bold text-gray-900 mb-4">Kurs Modullari</h3>
          
          <div class="space-y-3">
            <div 
              *ngFor="let module of courseData?.sp_courses_modules; let moduleIndex = index"
              class="border rounded-lg overflow-hidden"
            >
              <!-- Module Header -->
              <div 
                class="p-3 bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors"
                (click)="toggleModule(moduleIndex)"
              >
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-2">
                    <div class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold">
                      {{ moduleIndex + 1 }}
                    </div>
                    <span class="font-medium text-gray-900 text-sm">
                      {{ module.name_uz || module.name_ru || module.name_kr }}
                    </span>
                  </div>
                  <i 
                    class="pi text-gray-400 text-sm transition-transform"
                    [class.pi-chevron-down]="!expandedModules[moduleIndex]"
                    [class.pi-chevron-up]="expandedModules[moduleIndex]"
                  ></i>
                </div>
                <div class="text-xs text-gray-500 mt-1 ml-8">{{ module.duration }}</div>
              </div>

              <!-- Module Parts -->
              <div *ngIf="expandedModules[moduleIndex]" class="border-t">
                <div 
                  *ngFor="let part of module.sp_courses_module_parts; let partIndex = index"
                  class="p-3 hover:bg-gray-50 cursor-pointer transition-colors border-b last:border-b-0"
                  [class.bg-blue-50]="currentModuleIndex === moduleIndex && currentPartIndex === partIndex"
                  (click)="selectPart(moduleIndex, partIndex)"
                >
                  <div class="flex items-center space-x-2">
                    <i 
                      class="text-sm"
                      [class.pi-play-circle]="part.type === 'video_youtube' || part.type === 'video_server'"
                      [class.pi-file-text]="part.type === 'text'"
                      [class.pi-book]="part.type === 'gibrid'"
                      [class.text-green-600]="currentModuleIndex === moduleIndex && currentPartIndex === partIndex"
                      [class.text-gray-400]="!(currentModuleIndex === moduleIndex && currentPartIndex === partIndex)"
                    ></i>
                    <span 
                      class="text-sm"
                      [class.text-blue-600]="currentModuleIndex === moduleIndex && currentPartIndex === partIndex"
                      [class.font-medium]="currentModuleIndex === moduleIndex && currentPartIndex === partIndex"
                    >
                      {{ part.name_uz || part.name_ru || part.name_kr }}
                    </span>
                  </div>
                  <div class="text-xs text-gray-500 ml-6">{{ part.duration }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="lg:col-span-3">
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
          <!-- Content Header -->
          <div class="p-6 border-b">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">
                  {{ currentPart?.name_uz || currentPart?.name_ru || currentPart?.name_kr || 'Kursga xush kelibsiz' }}
                </h2>
                <div class="flex items-center space-x-4 text-sm text-gray-600">
                  <span class="flex items-center">
                    <i class="pi pi-clock mr-1"></i>
                    {{ currentPart?.duration || '0 min' }}
                  </span>
                  <span class="flex items-center">
                    <i 
                      class="mr-1"
                      [class.pi-play-circle]="currentPart?.type === 'video_youtube' || currentPart?.type === 'video_server'"
                      [class.pi-file-text]="currentPart?.type === 'text'"
                      [class.pi-book]="currentPart?.type === 'gibrid'"
                    ></i>
                    {{ getContentTypeLabel(currentPart?.type) }}
                  </span>
                </div>
              </div>
              
              <!-- Navigation Buttons -->
              <div class="flex space-x-2">
                <p-button 
                  icon="pi pi-chevron-left" 
                  [outlined]="true"
                  [disabled]="!hasPreviousPart()"
                  (onClick)="goToPreviousPart()"
                  pTooltip="Oldingi dars"
                >
                </p-button>
                <p-button 
                  icon="pi pi-chevron-right" 
                  [disabled]="!hasNextPart()"
                  (onClick)="goToNextPart()"
                  pTooltip="Keyingi dars"
                >
                </p-button>
              </div>
            </div>
          </div>

          <!-- Content Body -->
          <div class="p-6">
            <!-- Welcome Message -->
            <div *ngIf="!currentPart" class="text-center py-16">
              <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="pi pi-book text-blue-600 text-4xl"></i>
              </div>
              <h3 class="text-2xl font-bold text-gray-900 mb-4">{{ courseData?.name }} kursiga xush kelibsiz!</h3>
              <p class="text-gray-600 mb-8 max-w-2xl mx-auto">
                {{ courseData?.description }}
              </p>
              <p-button 
                label="Birinchi darsni boshlash" 
                icon="pi pi-play"
                (onClick)="startFirstLesson()"
              >
              </p-button>
            </div>

            <!-- Video Content -->
            <div *ngIf="currentPart?.type === 'video_youtube'" class="mb-6">
              <div class="aspect-video bg-gray-900 rounded-lg overflow-hidden">
                <iframe 
                  *ngIf="getYouTubeEmbedUrl(currentPart.content)"
                  [src]="getYouTubeEmbedUrl(currentPart.content)" 
                  class="w-full h-full"
                  frameborder="0" 
                  allowfullscreen
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                >
                </iframe>
                <div *ngIf="!getYouTubeEmbedUrl(currentPart.content)" class="w-full h-full flex items-center justify-center">
                  <div class="text-center text-white">
                    <i class="pi pi-video text-4xl mb-4"></i>
                    <p>Video mavjud emas</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Server Video Content -->
            <div *ngIf="currentPart?.type === 'video_server'" class="mb-6">
              <div class="aspect-video bg-gray-900 rounded-lg overflow-hidden">
                <video 
                  *ngIf="currentPart.file_video_id"
                  [src]="getServerVideoUrl(currentPart.file_video_id)"
                  class="w-full h-full"
                  controls
                  preload="metadata"
                >
                  Brauzeringiz video formatini qo'llab-quvvatlamaydi.
                </video>
                <div *ngIf="!currentPart.file_video_id" class="w-full h-full flex items-center justify-center">
                  <div class="text-center text-white">
                    <i class="pi pi-video text-4xl mb-4"></i>
                    <p>Video mavjud emas</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Text Content -->
            <div *ngIf="currentPart?.content && (currentPart?.type === 'text' || currentPart?.type === 'gibrid')" class="prose max-w-none">
              <div [innerHTML]="currentPart.content" class="text-gray-700 leading-relaxed"></div>
            </div>

            <!-- Lesson Completion -->
            <div *ngIf="currentPart" class="mt-8 pt-6 border-t">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <p-checkbox 
                    [(ngModel)]="currentPartCompleted"
                    [binary]="true"
                    (onChange)="markPartAsCompleted()"
                  >
                  </p-checkbox>
                  <label class="text-sm text-gray-700">Darsni yakunlangan deb belgilash</label>
                </div>
                
                <p-button 
                  *ngIf="hasNextPart()"
                  label="Keyingi dars" 
                  icon="pi pi-chevron-right" 
                  iconPos="right"
                  (onClick)="goToNextPart()"
                >
                </p-button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>