<ng-template pTemplate="header">
  <div class="flex items-center justify-between w-full">
    <h3 class="text-xl font-bold text-gray-900">{{ selectedTest?.title }}</h3>
    <div class="flex items-center space-x-4 text-sm text-gray-600">
      <span>{{ currentQuestionIndex() + 1 }} / {{ selectedTest?.totalQuestions }}</span>
      <span class="flex items-center" [class.text-red-600]="timeRemaining() < 300">
        <i class="pi pi-clock mr-1"></i>
        {{ formatTime(timeRemaining()) }}
      </span>
    </div>
  </div>
</ng-template>

<div class="py-4" *ngIf="selectedTest && currentQuestion()">
  <!-- Progress Bar -->
  <p-progressBar [value]="progressPercentage()" class="mb-6 h-2" [showValue]="false">
  </p-progressBar>

  <!-- Question -->
  <div class="mb-6">
    <h4 class="text-lg font-semibold text-gray-900 mb-4">
      {{ currentQuestion()?.question }}
    </h4>

    <!-- Options -->
    <div class="space-y-3">
      <div
        *ngFor="let option of currentQuestion()?.options; let i = index"
        class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-200"
        [class.border-blue-500]="selectedAnswer() === i"
        [class.bg-blue-50]="selectedAnswer() === i"
        (click)="selectAnswer(i)"
      >
        <p-radioButton
          [inputId]="'option' + i"
          [value]="i"
          [ngModel]="selectedAnswer()"
          (ngModelChange)="selectAnswer($event)"
        >
        </p-radioButton>
        <label [for]="'option' + i" class="ml-3 cursor-pointer flex-1">
          {{ option }}
        </label>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="flex items-center justify-between">
    <p-button
      label="Oldingi"
      icon="pi pi-chevron-left"
      [outlined]="true"
      [disabled]="currentQuestionIndex() === 0"
      (onClick)="previousQuestion()"
    >
    </p-button>

    <div class="flex space-x-2">
      <p-button
        label="Testni yakunlash"
        icon="pi pi-times"
        [outlined]="true"
        severity="danger"
        (onClick)="showFinishConfirmation()"
      >
      </p-button>

      <p-button
        [label]="isLastQuestion() ? 'Yakunlash' : 'Keyingi'"
        [icon]="isLastQuestion() ? 'pi pi-check' : 'pi pi-chevron-right'"
        [iconPos]="isLastQuestion() ? 'left' : 'right'"
        (onClick)="nextQuestion()"
        class="btn-primary"
      >
      </p-button>
    </div>
  </div>

  <!-- Question Navigation -->
  <div class="mt-6 pt-6 border-t border-gray-200">
    <h5 class="text-sm font-semibold text-gray-700 mb-3">Savollar bo'yicha navigatsiya</h5>
    <div class="grid grid-cols-10 gap-2">
      <button
        *ngFor="let question of selectedTest?.questions; let i = index"
        class="w-8 h-8 rounded-full text-xs font-medium transition-colors duration-200"
        [class.bg-blue-600]="i === currentQuestionIndex()"
        [class.text-white]="i === currentQuestionIndex()"
        [class.bg-green-100]="i !== currentQuestionIndex() && hasAnswer(i)"
        [class.text-green-700]="i !== currentQuestionIndex() && hasAnswer(i)"
        [class.bg-gray-100]="i !== currentQuestionIndex() && !hasAnswer(i)"
        [class.text-gray-600]="i !== currentQuestionIndex() && !hasAnswer(i)"
        [class.hover:bg-blue-500]="i !== currentQuestionIndex()"
        [class.hover:text-white]="i !== currentQuestionIndex()"
        (click)="goToQuestion(i)"
      >
        {{ i + 1 }}
      </button>
    </div>
    <div class="flex items-center justify-center space-x-4 mt-3 text-xs text-gray-600">
      <div class="flex items-center">
        <div class="w-3 h-3 bg-blue-600 rounded-full mr-1"></div>
        <span>Joriy</span>
      </div>
      <div class="flex items-center">
        <div class="w-3 h-3 bg-green-100 rounded-full mr-1"></div>
        <span>Javob berilgan</span>
      </div>
      <div class="flex items-center">
        <div class="w-3 h-3 bg-gray-100 rounded-full mr-1"></div>
        <span>Javobsiz</span>
      </div>
    </div>
  </div>
</div>

<!-- Finish Confirmation Dialog -->
<p-dialog
  [visible]="showFinishDialog()"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '400px' }"
  header="Testni yakunlash"
>
  <div class="text-center py-4">
    <i class="pi pi-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>
    <p class="text-gray-700 mb-4">
      Testni yakunlashni xohlaysizmi? Bu amalni bekor qilib bo'lmaydi.
    </p>
    <div class="space-y-2 text-sm text-gray-600">
      <p>Javob berilgan savollar: {{ answeredQuestionsCount() }}</p>
      <p>Javobsiz savollar: {{ unansweredQuestionsCount() }}</p>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <div class="flex justify-end space-x-2">
      <p-button label="Bekor qilish" [outlined]="true" (onClick)="showFinishDialog.set(false)">
      </p-button>
      <p-button label="Yakunlash" severity="danger" (onClick)="finishTest()"> </p-button>
    </div>
  </ng-template>
</p-dialog>
